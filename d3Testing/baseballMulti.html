<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>d3 take 2</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

  <style>

  text {
    font-size: 16px;
  }



  </style>
</head>
<body>
  <div id='container'></div>

  <button id='hr'>HR and RBI</button>
  <button id='slg'>OBP, SLG and OPS></button>


<script>

  var data1 = [
  {year: 2000, OBP: .450, OPS: .821, SLG: .501, RBI: 130, HR: 40},
  {year: 2001, OBP: .410, OPS: .801, SLG: .601, RBI: 120, HR: 50},
  {year: 2002, OBP: .420, OPS: .701, SLG: .401, RBI: 110, HR: 30},
  {year: 2003, OBP: .400, OPS: .961, SLG: .501, RBI: 100, HR: 21},
  {year: 2004, OBP: .450, OPS: .801, SLG: .521, RBI: 130, HR: 6}
]

var data2 = [
  {year: 1980, OBP: .400, OPS: .901, SLG: .601, RBI: 92, HR: 35},
  {year: 1981, OBP: .460, OPS: 1.001, SLG: .701, RBI: 131, HR: 19},
  {year: 1982, OBP: .320, OPS: .601, SLG: .501, RBI: 86, HR: 12}
]

var data3 = [
  {year: 1990, OBP: .410, OPS: .908, SLG: .621, RBI: 131, HR: 25},
  {year: 1991, OBP: .440, OPS: 1.021, SLG: .741, RBI: 140, HR: 22},
  {year: 1992, OBP: .350, OPS: .961, SLG: .401, RBI: 60, HR: 21},
  {year: 1993, OBP: .403, OPS: .860, SLG: .600, RBI: 99, HR: 60}
]


const height = 500
const width = 1000

var svg = d3.select('#container')
  .append('svg')
  .attr('height', height)
  .attr('width', width)
  .style('border', '1px solid black')
  .style('overflow', 'visible')
  .style('margin', '40px')
  .style('background', 'white')

  const radius = 20
  const padding = 30

  var data = [data1, data2, data3]

  function renderData(data, index, xScale, yScale, stats){
    
    
    stats.forEach((stat, statIndex) => {

    svg.selectAll('.d3BubbleG' + index)
      .data(data)
      .enter()
      .append('g')
      .classed('d3BubbleG' + index, true) 

    var obj = d3.selectAll('.d3BubbleG' + index)
      .style('fill', (d) => {
        if (index === 0) {
          return 'rgba(22, 97, 247, .8)'
        } else if (index === 1) {
       
          return 'rgba(252, 30, 41, .8)'
        } else {
          return 'rgba(237, 252, 30, .8)'
        }
      })

      if (statIndex === 0) {
        obj
          .append('circle')
          .attr('cx', (d, i) => xScale(i + (Math.random()*2)/40))
          .attr('cy', (d) => yScale(d[stat])) 
          .attr('r', 8)
      } else if (statIndex === 1 ){
          obj
            .append('rect')
            .attr('x', (d, i) => xScale(i + (Math.random()*2)/40))
            .attr('y', (d) => yScale(d[stat])) 
            .attr('height', 12)
            .attr('width', 12)
      } else {
        obj
        .append('circle')
        .attr('cx', (d, i) => xScale(i + (Math.random()*2)/40))
        .attr('cy', (d) => yScale(d[stat])) 
        .attr('r', 8)
        .style('stroke', (d) => {
          if (index === 0) {
            return 'rgba(22, 97, 247, .8)'
          } else if (index === 1) {
            return 'rgba(252, 30, 41, .8)'
          } else {
            return 'rgba(237, 252, 30, .8)'
          }
        })
        .style('fill', 'transparent')
      }

    obj.on('mouseover', function(){
      console.log(d3.select(this))
    }).on('mouseout', function(){
      console.log('outttt')
    })


    })
    // end of looping through all stats

  }
  // end of renderData


  function renderChart(data, stats) {
    d3.select('svg').selectAll('*').remove()

    var min = d3.min(data.map((d) => {
      return d3.min(d.map((e) => {
        return d3.min(stats.map((stat) => e[stat]))
      }))
    }))

    var max = d3.max(data.map((d) => {
      return d3.max(d.map((e) => {
        return d3.max(stats.map((stat) => e[stat]))
      }))
    }))

    var xScale = d3.scaleLinear()
      .domain([0, d3.max(data.map((d) => d.length))])
      .range([padding, width - padding])

    var yScale = d3.scaleLinear()
      .domain([min, max])
      .range([height - padding, padding])

    var yAxisScale = d3.scaleLinear()
      .domain([min, max])
      .range([height, height - padding])

    var xAxisScale = d3.scaleLinear()
      .domain([1, d3.max(data.map((d) => d.length)) + 1])
      .range([padding, width - padding])


    var xAxis = d3.axisBottom()
      .scale(xAxisScale)
      .ticks(d3.max(data.map((d) => d.length)) + 1)

    var yAxis = d3.axisLeft()
      .scale(yScale)


    d3.select('svg')
      .append('g')
      .attr('transform', 'translate(0,' + height + ')')
      .call(xAxis)

    d3.select('svg')
      .append('g')
      .call(yAxis)



    var rect = d3.select('svg')
      .append('g')

    rect.append('rect')
      .classed('moveableRect', true)
      .attr('x', 0)
      .attr('y', height)
      .style('fill', 'none')
      .style('stroke', 'black')

    d3.select('#container')
      .append('div')
      .classed('toolTipText', true)
      .classed('toolTipYear', true)
      .text('')

    d3.select('#container')
      .append('div')
      .classed('toolTipText', true)
      .classed('toolTipNum', true)
      .text()












    
    data.forEach((d, index) => renderData(d, index, xScale, yScale, stats))
  }


  $('#hr').on('click', function(){
    renderChart(data, ['HR', 'RBI'])
  })

  $('#slg').on('click', function(){
    renderChart(data, ['SLG', 'OPS', 'OBP'])
  })


  </script>
</body>
</html>
